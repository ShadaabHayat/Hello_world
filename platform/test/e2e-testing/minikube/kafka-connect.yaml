apiVersion: v1
kind: Service
metadata:
  name: kafka-connect
spec:
  selector:
    app: kafka-connect
  ports:
    - protocol: TCP
      port: 80
      targetPort: webui
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kafka-connect
  namespace: default
  labels:
    app: kafka-connect
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kafka-connect
  template:
    metadata:
      labels:
        app: kafka-connect
    spec:
      containers:
      - name: kafka-connect
        image: localhost/s3-custom-image:e2e-test
        imagePullPolicy: Never
        ports:
          - containerPort: 8083
            name: webui
        env:
          - name: CONNECT_BOOTSTRAP_SERVERS
            valueFrom:
              configMapKeyRef:
                name: kafka-cluster-bootstrap-servers
                key: BOOTSTRAP_SERVERS
          - name: CONNECT_REST_ADVERTISED_HOST_NAME
            value: 'kafka-connect.default.svc.cluster.local'
          - name: CONNECT_REST_PORT
            value: '8083'
          - name: CONNECT_GROUP_ID
            value: 'connect-cluster-group'
          - name: CONNECT_CONFIG_STORAGE_TOPIC
            value: '_kafka-connect-configs'
          - name: CONNECT_OFFSET_STORAGE_TOPIC
            value: '_kafka-connect-offsets'
          - name: CONNECT_STATUS_STORAGE_TOPIC
            value: '_kafka-connect-status'
          - name: CONNECT_KEY_CONVERTER
            value: 'org.apache.kafka.connect.storage.StringConverter'
          - name: CONNECT_KEY_CONVERTER_SCHEMAS_ENABLE
            value: 'false'
          - name: CONNECT_VALUE_CONVERTER
            value: "io.confluent.connect.avro.AvroConverter"
          - name: CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL
            value: "http://kafka-schema-registry.default.svc.cluster.local"
          - name: CONNECT_VALUE_CONVERTER_SCHEMAS_ENABLE
            value: "false"
          - name: CONNECT_INTERNAL_KEY_CONVERTER
            value: "org.apache.kafka.connect.storage.StringConverter"
          - name: CONNECT_INTERNAL_VALUE_CONVERTER
            value: "io.confluent.connect.avro.AvroConverter"
          - name: CONNECT_INTERNAL_KEY_CONVERTER_SCHEMAS_ENABLE
            value: "false"
          - name: CONNECT_INTERNAL_VALUE_CONVERTER_SCHEMAS_ENABLE
            value: "false"
          - name: CONNECT_LOG4J_ROOT_LOGLEVEL
            value: "INFO"
          - name: CONNECT_LOG4J_LOGGERS
            value: "org.apache.kafka.connect.runtime.rest=WARN,org.reflections=ERROR"
          - name: CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR
            value: "1"
          - name: CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR
            value: "1"
          - name: CONNECT_STATUS_STORAGE_REPLICATION_FACTOR
            value: "1"
          - name: CONNECT_PLUGIN_PATH
            value: '/usr/share/java,/usr/share/confluent-hub-components/,/custom-plugins/'
          - name: CONNECT_CONFIG_PROVIDERS
            value: "env"
          - name: CONNECT_CONFIG_PROVIDERS_ENV_CLASS
            value: "org.apache.kafka.common.config.provider.EnvVarConfigProvider"
          - name: RDC_INFO
            value: "minikube"
          - name: ENV_INFO
            value: "e2e-test"
          - name: AWS_ACCESS_KEY_ID
            value: "minioadmin"
          - name: AWS_SECRET_ACCESS_KEY
            value: "minioadmin"
